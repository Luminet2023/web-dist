import{c8 as ye,E as he,c9 as me,ca as H,ai as fe,X as ge,h as a,a7 as se,aJ as V,U as K,b as ve,c4 as U,cb as F,e as be,ax as _e,b9 as N,bX as we,cc as xe,cd as Se,ce as ke,cf as Ce,a as $e,k as Ie,m as R,cg as Ee,aW as ie,a4 as Oe,bQ as ce,au as je,bP as Pe,S as M,I as le,ch as pe,b5 as Te,ae as Ge,C as ue,az as Le,bk as Re,bl as Ue,al as ze,ci as Ae,aC as Be,bG as de,n as E,ba as Me,c as Ne,cj as Fe}from"./index.7ab50735.js";import{a as De}from"./useTitle.798574af.js";import{s as Je,g as Ke,a as He}from"./webauthn-json.browser-ponyfill.1c672167.js";const Ve="https://github.com/alist-org/alist";function We(l){return ye(`${l}-${Ve}`)}const Ze=fe('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="896" width="967.8852157128662"><defs><path id="path-2" opacity="1" fill-rule="evenodd" d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id="linearGradient-3" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-2" fill="url(#linearGradient-3)" fill-opacity="1"></use></g></svg>'),qe=l=>{const m=he({startColor:"#28aff0",endColor:"#120fc4"},l);return(()=>{const g=Ze.cloneNode(!0),_=g.firstChild,b=_.firstChild,f=b.nextSibling,v=f.firstChild,d=v.nextSibling;return me(c=>{const h=m.startColor,w=m.endColor;return h!==c._v$&&H(v,"stop-color",c._v$=h),w!==c._v$2&&H(d,"stop-color",c._v$2=w),c},{_v$:void 0,_v$2:void 0}),g})()},Qe=fe('<svg height="1337" width="1337"><defs><path id="path-1" opacity="1" fill-rule="evenodd" d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id="linearGradient-2" x1="0.79" y1="0.62" x2="0.21" y2="0.86"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-1" fill="url(#linearGradient-2)" fill-opacity="1"></use></g></svg>'),Xe=l=>{const m=he({startColor:"#28aff0",endColor:"#120fc4"},l);return(()=>{const g=Qe.cloneNode(!0),_=g.firstChild,b=_.firstChild,f=b.nextSibling,v=f.firstChild,d=v.nextSibling;return me(c=>{const h=m.startColor,w=m.endColor;return h!==c._v$&&H(v,"stop-color",c._v$=h),w!==c._v$2&&H(d,"stop-color",c._v$2=w),c},{_v$:void 0,_v$2:void 0}),g})()},Ye=()=>{const l=ge("#a9c6ff","#062b74");return a(se,{get bgColor(){return l()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[a(se,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return a(Xe,{})}}),a(se,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return a(qe,{})}})]}})},et=()=>{const l=V("sso_login_enabled"),m=K("sso_login_platform"),g=V("sso_compatibility_mode"),{searchParams:_,to:b}=ve(),f=_.token;f!=null&&f!=""&&(U(f),b(decodeURIComponent(_.redirect||F||"/"),!0));function v(d){const c=d.data;c.token&&(U(c.token),b(decodeURIComponent(_.redirect||F||"/"),!0))}if(window.addEventListener("message",v),be(()=>{window.removeEventListener("message",v)}),l){const d=()=>{const h=N.getUri()+"/auth/sso?method=sso_get_token";if(g){window.location.href=h;return}window.open(h,"authPopup","width=500,height=600")};let c;switch(m){case"Github":c=Ce;break;case"Microsoft":c=ke;break;case"Google":c=Se;break;case"Dingtalk":c=xe;break;default:c=we}return a(_e,{cursor:"pointer",boxSize:"$8",as:c,p:"$0_5",onclick:d})}};(function(l){if(typeof l>"u")throw new Error("Geetest requires browser environment");var m=l.document,g=l.Math,_=m.getElementsByTagName("head")[0],b=1e4;function f(e){this._obj=e}f.prototype={_each:function(e){var n=this._obj;for(var t in n)n.hasOwnProperty(t)&&e(t,n[t]);return this},_extend:function(e){var n=this;new f(e)._each(function(t,r){n._obj[t]=r})}};var v=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=g.random()*16|0,t=e==="x"?n:n&3|8;return t.toString(16)})};function d(e){var n=this;new f(e)._each(function(t,r){n[t]=r})}d.prototype={apiServers:["gcaptcha4.geetest.com","gcaptcha4.geevisit.com","gcaptcha4.gsensebot.com"],staticServers:["static.geetest.com","static.geevisit.com"],protocol:"http://",typePath:"/load",fallback_config:{bypass:{staticServers:["static.geetest.com","static.geevisit.com"],type:"bypass",bypass:"/v4/bypass.js"}},_get_fallback_config:function(){var e=this;return h(e.type)?e.fallback_config[e.type]:e.fallback_config.bypass},_extend:function(e){var n=this;new f(e)._each(function(t,r){n[t]=r})}};var c=function(e){return typeof e=="number"},h=function(e){return typeof e=="string"},w=function(e){return typeof e=="boolean"},j=function(e){return typeof e=="object"&&e!==null},W=function(e){return typeof e=="function"},P=/Mobi/i.test(navigator.userAgent),C={},x={},D=function(){return parseInt(g.random()*1e4)+new Date().valueOf()},Z=function(e,n){if(typeof e=="function"){var t=Array.prototype.slice.call(arguments,2);return Function.prototype.bind?e.bind(n,t):function(){var r=Array.prototype.slice.call(arguments);return e.apply(n,t.concat(r))}}},T=Object.prototype.toString,q=function(e){return typeof e=="function"},Q=function(e){return e===Object(e)},z=function(e){return T.call(e)=="[object Array]"},A=function(e){return T.call(e)=="[object Date]"},X=function(e){return T.call(e)=="[object RegExp]"},Y=function(e){return T.call(e)=="[object Boolean]"};function B(e){return e.replace(/(\S)(_([a-zA-Z]))/g,function(n,t,r,o){return t+o.toUpperCase()||""})}function $(e,n){if(!Q(e)||A(e)||X(e)||Y(e)||q(e))return n?B(e):e;if(z(e))for(var t=[],r=0;r<e.length;r++)t.push($(e[r]));else{var t={};for(var o in e)e.hasOwnProperty(o)&&(t[$(o,!0)]=$(e[o]))}return t}var ee=function(e,n,t){var r=m.createElement("script");r.charset="UTF-8",r.async=!0,/static\.geetest\.com/g.test(e)&&(r.crossOrigin="anonymous"),r.onerror=function(){n(!0),o=!0};var o=!1;r.onload=r.onreadystatechange=function(){!o&&(!r.readyState||r.readyState==="loaded"||r.readyState==="complete")&&(o=!0,setTimeout(function(){n(!1)},0))},r.src=e,_.appendChild(r),setTimeout(function(){o||(r.onerror=r.onload=null,r.remove&&r.remove(),n(!0))},t||b)},J=function(e){return e.replace(/^https?:\/\/|\/$/g,"")},te=function(e){return e=e&&e.replace(/\/+/g,"/"),e.indexOf("/")!==0&&(e="/"+e),e},re=function(e){if(!e)return"";var n="?";return new f(e)._each(function(t,r){(h(r)||c(r)||w(r))&&(n=n+encodeURIComponent(t)+"="+encodeURIComponent(r)+"&")}),n==="?"&&(n=""),n.replace(/&$/,"")},ne=function(e,n,t,r){n=J(n);var o=te(t)+re(r);return n&&(o=e+n+o),o},i=function(e,n,t,r,o,u,y){var I=function(S){if(y){var k="geetest_"+D();l[k]=Z(y,null,k),o.callback=k}var L=ne(n,t[S],r,o);ee(L,function(oe){if(oe){if(k)try{l[k]=function(){l[k]=null}}catch{}S>=t.length-1?u(!0):I(S+1)}else u(!1)},e.timeout)};I(0)},s=function(e,n,t,r){var o=function(u,y){y.status=="success"?r(y.data):(y.status,r(y)),l[u]=void 0;try{delete l[u]}catch{}};i(t,t.protocol,e,n,{callback:"",captcha_id:t.captchaId,challenge:t.challenge||v(),client_type:P?"h5":"web",risk_type:t.riskType,user_info:t.userInfo,call_type:t.callType,lang:t.language?t.language:navigator.appName==="Netscape"?navigator.language.toLowerCase():navigator.userLanguage.toLowerCase()},function(u){if(u&&typeof t.offlineCb=="function"){t.offlineCb();return}u&&r(t._get_fallback_config())},o)},p=function(e,n,t){var r={networkError:"\u7F51\u7EDC\u9519\u8BEF",gtTypeError:"gt\u5B57\u6BB5\u4E0D\u662F\u5B57\u7B26\u4E32\u7C7B\u578B"};if(typeof n.onError=="function")n.onError({desc:t.desc,msg:t.msg,code:t.code});else throw new Error(r[e])},O=function(){return l.Geetest||m.getElementById("gt_lib")};O()&&(x.slide="loaded");var G=function(e){var n=!1,t={js:"script",css:"link"},r=e&&t[e.split(".").pop()];if(r!==void 0){var o=m.getElementsByTagName(r);for(var u in o)(o[u].href&&o[u].href.toString().indexOf(e)>0||o[u].src&&o[u].src.toString().indexOf(e)>0)&&(n=!0)}return n};l.initGeetest4=function(e,n){var t=new d(e);e.https?t.protocol="https://":e.protocol||(t.protocol=l.location.protocol+"//"),j(e.getType)&&t._extend(e.getType),s(t.apiServers,t.typePath,t,function(o){var o=$(o);if(o.status==="error")return p("networkError",t,o);var u=o.type;t.debug&&new f(o)._extend(t.debug);var y=function(){t._extend(o),n(new l.Geetest4(t))};C[u]=C[u]||[];var I=x[u]||"init";if(I==="init")x[u]="loading",C[u].push(y),o.gctPath&&i(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:o.staticServers||t.staticServers,o.gctPath,null,function(S){S&&p("networkError",t,{code:"60205",msg:"Network failure",desc:{detail:"gct resource load timeout"}})}),i(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:o.staticServers||t.staticServers,o.bypass||o.staticPath+o.js,null,function(S){if(S)x[u]="fail",p("networkError",t,{code:"60204",msg:"Network failure",desc:{detail:"js resource load timeout"}});else{x[u]="loaded";for(var k=C[u],L=0,oe=k.length;L<oe;L=L+1){var ae=k[L];W(ae)&&ae()}C[u]=[],x[u]="init"}});else{if(I==="loaded")return o.gctPath&&!G(o.gctPath)&&i(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:o.staticServers||t.staticServers,o.gctPath,null,function(S){S&&p("networkError",t,{code:"60205",msg:"Network failure",desc:{detail:"gct resource load timeout"}})}),y();I==="fail"?p("networkError",t,{code:"60204",msg:"Network failure",desc:{detail:"js resource load timeout"}}):I==="loading"&&C[u].push(y)}})}})(window);const tt=fe('<div id="captcha"></div>'),at=()=>{const l=K("logo").split(`
`),m=ge(l[0],l.pop()),g=$e(),_=Ie(()=>`${g("login.login_to")} ${K("site_title")}`);De(_);const b=ge("white","$neutral1"),[f,v]=R(localStorage.getItem("username")||""),[d,c]=R(localStorage.getItem("password")||""),[h,w]=R(""),[j,W]=R(!1),[P,C]=Ee("remember-pwd","false"),[x,D]=R(!1),[Z,T]=ie(async()=>{const i=localStorage.getItem("captcha"),s=i?JSON.parse(i):null;return x()?N.post("/auth/login/ldap",{username:f(),password:d(),otp_code:h(),lot_number:s.lot_number,captcha_output:s.captcha_output,pass_token:s.pass_token,gen_time:s.gen_time,sign_token:s.sign_token}):N.post("/auth/login/verify_captcha",{username:f(),password:We(d()),otp_code:h(),lot_number:s.lot_number,captcha_output:s.captcha_output,pass_token:s.pass_token,gen_time:s.gen_time,sign_token:s.sign_token})}),[,q]=ie((i,s,p)=>N.post("/authn/webauthn_finish_login?username="+p,JSON.stringify(s),{headers:{session:i}})),[,Q]=ie(i=>N.get("/authn/webauthn_begin_login?username="+i)),{searchParams:z,to:A}=ve(),X=V("webauthn_login_enabled"),Y=async()=>{W(!j())},B=async()=>{if(j()){if(!Je()){E.error(g("users.webauthn_not_supported"));return}U(),P()==="true"?localStorage.setItem("username",f()):localStorage.removeItem("username");const i=await Q(f());Me(i,async s=>{try{const p=Ke(s.options),O=await He(p),G=await q(s.session,O,f());de(G,e=>{E.success(g("login.success")),U(e.token),A(decodeURIComponent(z.redirect||F||"/"),!0)})}catch(p){p instanceof Error&&E.error(p.message)}})}else{P()==="true"?(localStorage.setItem("username",f()),localStorage.setItem("password",d())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const i=await T();de(i,s=>{E.success(g("login.success")),U(s.token),A(decodeURIComponent(z.redirect||F||"/"),!0)},(s,p)=>{!$()&&p===402?ee(!0):E.error(s)})}},[$,ee]=R(!1),J=V("ldap_login_enabled"),te=K("ldap_login_tips");J&&D(!0);async function re(i){try{return(await Ne.get(i)).data}catch(s){throw E.error(s),s}}const ne=()=>{const i=Fe+"/api/auth/create_mmt";re(i).then(s=>{const p={gt:s.gt,challenge:s.challenge,offline:!s.success,new_captcha:s.new_captcha};initGeetest(p,O=>{O.appendTo("#captcha"),O.onReady(function(){}).onSuccess(function(){let G=O.getValidate();console.log(G),localStorage.setItem("captcha",JSON.stringify(G)),B()}).onError(function(){E.error("\u80A5\u9E21\u9A8C\u8BC1\u5931\u8D25")})})}).catch(s=>{E.error("\u80A5\u9E21\u9A8C\u8BC1\u5931\u8D25")})};return a(Be,{zIndex:"1",w:"$full",h:"100vh",get children(){return[a(Oe,{get bgColor(){return b()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[a(ce,{alignItems:"center",justifyContent:"space-around",get children(){return[a(je,{mr:"$2",boxSize:"$12",get src(){return m()}}),a(Pe,{color:"$info9",fontSize:"$2xl",get children(){return _()}})]}}),a(M,{get when(){return!$()},get fallback(){return a(le,{id:"totp",name:"otp",get placeholder(){return g("login.otp-tips")},get value(){return h()},onInput:i=>w(i.currentTarget.value),onKeyDown:i=>{i.key==="Enter"&&B()}})},get children(){return[a(le,{name:"username",get placeholder(){return g("login.username-tips")},get value(){return f()},onInput:i=>v(i.currentTarget.value)}),a(M,{get when(){return!j()},get children(){return a(le,{name:"password",get placeholder(){return g("login.password-tips")},type:"password",get value(){return d()},onInput:i=>c(i.currentTarget.value),onKeyDown:i=>{i.key==="Enter"&&B()}})}}),a(ce,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[a(pe,{get checked(){return P()==="true"},onChange:()=>C(P()==="true"?"false":"true"),get children(){return g("login.remember")}}),a(Te,{as:"a",target:"_blank",get href(){return g("login.forget_url")},get children(){return g("login.forget")}})]}})]}}),a(Ge,{w:"$full",spacing:"$2",get children(){return[a(M,{get when(){return!j()},get children(){return a(ue,{colorScheme:"primary",w:"$full",onClick:()=>{$()?w(""):(v(""),c(""))},get children(){return g("login.clear")}})}}),a(ue,{w:"$full",get loading(){return Z()},class:"g-recaptcha","data-sitekey":"reCAPTCHA_site_key","data-callback":"onSubmit","data-action":"submit",onclick:ne,get children(){return g("login.login")}})]}}),a(M,{when:J,get children(){return a(pe,{w:"$full",get checked(){return x()===!0},onChange:()=>D(!x()),children:te})}}),a(ue,{w:"$full",colorScheme:"accent",onClick:()=>{U(),A(decodeURIComponent(z.redirect||F||"/"),!0)}}),Le(()=>g("login.use_guest")),tt.cloneNode(!0),a(ce,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[a(Re,{}),a(Ue,{}),a(et,{}),a(M,{when:X,get children(){return a(_e,{cursor:"pointer",boxSize:"$8",get color(){return ze()},as:Ae,p:"$0_5",onclick:Y})}})]}})]}}),a(Ye,{})]}})};export{at as default};
