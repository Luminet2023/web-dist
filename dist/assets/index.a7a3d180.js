import{c7 as ye,E as he,c8 as me,c9 as J,aH as fe,X as ge,h as a,a7 as se,aE as K,U as H,b as ve,c3 as R,ca as z,e as be,aB as _e,b6 as N,bV as xe,cb as we,cc as Se,cd as ke,ce as Ce,a as $e,k as Ie,m as G,cf as Ee,aT as ie,a4 as Oe,bO as ce,ar as Te,bN as je,S as M,I as le,cg as pe,b2 as Pe,aq as Ge,C as ue,bh as Le,bi as Re,ag as Ue,ch as Be,av as Ae,bE as de,n as L,b7 as Me}from"./index.7135cef6.js";import{a as Ne}from"./useTitle.8506f232.js";import{s as ze,g as Fe,a as De}from"./webauthn-json.browser-ponyfill.1c672167.js";const He="https://github.com/alist-org/alist";function Je(l){return ye(`${l}-${He}`)}const Ke=fe('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="896" width="967.8852157128662"><defs><path id="path-2" opacity="1" fill-rule="evenodd" d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id="linearGradient-3" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-2" fill="url(#linearGradient-3)" fill-opacity="1"></use></g></svg>'),Ve=l=>{const h=he({startColor:"#28aff0",endColor:"#120fc4"},l);return(()=>{const g=Ke.cloneNode(!0),v=g.firstChild,y=v.firstChild,f=y.nextSibling,m=f.firstChild,p=m.nextSibling;return me(s=>{const d=h.startColor,b=h.endColor;return d!==s._v$&&J(m,"stop-color",s._v$=d),b!==s._v$2&&J(p,"stop-color",s._v$2=b),s},{_v$:void 0,_v$2:void 0}),g})()},qe=fe('<svg height="1337" width="1337"><defs><path id="path-1" opacity="1" fill-rule="evenodd" d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id="linearGradient-2" x1="0.79" y1="0.62" x2="0.21" y2="0.86"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-1" fill="url(#linearGradient-2)" fill-opacity="1"></use></g></svg>'),Ze=l=>{const h=he({startColor:"#28aff0",endColor:"#120fc4"},l);return(()=>{const g=qe.cloneNode(!0),v=g.firstChild,y=v.firstChild,f=y.nextSibling,m=f.firstChild,p=m.nextSibling;return me(s=>{const d=h.startColor,b=h.endColor;return d!==s._v$&&J(m,"stop-color",s._v$=d),b!==s._v$2&&J(p,"stop-color",s._v$2=b),s},{_v$:void 0,_v$2:void 0}),g})()},We=()=>{const l=ge("#a9c6ff","#062b74");return a(se,{get bgColor(){return l()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[a(se,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return a(Ze,{})}}),a(se,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return a(Ve,{})}})]}})},Qe=()=>{const l=K("sso_login_enabled"),h=H("sso_login_platform"),g=K("sso_compatibility_mode"),{searchParams:v,to:y}=ve(),f=v.token;f!=null&&f!=""&&(R(f),y(decodeURIComponent(v.redirect||z||"/"),!0));function m(p){const s=p.data;s.token&&(R(s.token),y(decodeURIComponent(v.redirect||z||"/"),!0))}if(window.addEventListener("message",m),be(()=>{window.removeEventListener("message",m)}),l){const p=()=>{const d=N.getUri()+"/auth/sso?method=sso_get_token";if(g){window.location.href=d;return}window.open(d,"authPopup","width=500,height=600")};let s;switch(h){case"Github":s=Ce;break;case"Microsoft":s=ke;break;case"Google":s=Se;break;case"Dingtalk":s=we;break;default:s=xe}return a(_e,{cursor:"pointer",boxSize:"$8",as:s,p:"$0_5",onclick:p})}};(function(l){if(typeof l>"u")throw new Error("Geetest requires browser environment");var h=l.document,g=l.Math,v=h.getElementsByTagName("head")[0],y=1e4;function f(e){this._obj=e}f.prototype={_each:function(e){var n=this._obj;for(var t in n)n.hasOwnProperty(t)&&e(t,n[t]);return this},_extend:function(e){var n=this;new f(e)._each(function(t,r){n._obj[t]=r})}};var m=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=g.random()*16|0,t=e==="x"?n:n&3|8;return t.toString(16)})};function p(e){var n=this;new f(e)._each(function(t,r){n[t]=r})}p.prototype={apiServers:["gcaptcha4.geetest.com","gcaptcha4.geevisit.com","gcaptcha4.gsensebot.com"],staticServers:["static.geetest.com","static.geevisit.com"],protocol:"http://",typePath:"/load",fallback_config:{bypass:{staticServers:["static.geetest.com","static.geevisit.com"],type:"bypass",bypass:"/v4/bypass.js"}},_get_fallback_config:function(){var e=this;return d(e.type)?e.fallback_config[e.type]:e.fallback_config.bypass},_extend:function(e){var n=this;new f(e)._each(function(t,r){n[t]=r})}};var s=function(e){return typeof e=="number"},d=function(e){return typeof e=="string"},b=function(e){return typeof e=="boolean"},O=function(e){return typeof e=="object"&&e!==null},V=function(e){return typeof e=="function"},T=/Mobi/i.test(navigator.userAgent),C={},x={},F=function(){return parseInt(g.random()*1e4)+new Date().valueOf()},q=function(e,n){if(typeof e=="function"){var t=Array.prototype.slice.call(arguments,2);return Function.prototype.bind?e.bind(n,t):function(){var r=Array.prototype.slice.call(arguments);return e.apply(n,t.concat(r))}}},j=Object.prototype.toString,Z=function(e){return typeof e=="function"},W=function(e){return e===Object(e)},U=function(e){return j.call(e)=="[object Array]"},B=function(e){return j.call(e)=="[object Date]"},Q=function(e){return j.call(e)=="[object RegExp]"},X=function(e){return j.call(e)=="[object Boolean]"};function A(e){return e.replace(/(\S)(_([a-zA-Z]))/g,function(n,t,r,o){return t+o.toUpperCase()||""})}function $(e,n){if(!W(e)||B(e)||Q(e)||X(e)||Z(e))return n?A(e):e;if(U(e))for(var t=[],r=0;r<e.length;r++)t.push($(e[r]));else{var t={};for(var o in e)e.hasOwnProperty(o)&&(t[$(o,!0)]=$(e[o]))}return t}var Y=function(e,n,t){var r=h.createElement("script");r.charset="UTF-8",r.async=!0,/static\.geetest\.com/g.test(e)&&(r.crossOrigin="anonymous"),r.onerror=function(){n(!0),o=!0};var o=!1;r.onload=r.onreadystatechange=function(){!o&&(!r.readyState||r.readyState==="loaded"||r.readyState==="complete")&&(o=!0,setTimeout(function(){n(!1)},0))},r.src=e,v.appendChild(r),setTimeout(function(){o||(r.onerror=r.onload=null,r.remove&&r.remove(),n(!0))},t||y)},D=function(e){return e.replace(/^https?:\/\/|\/$/g,"")},ee=function(e){return e=e&&e.replace(/\/+/g,"/"),e.indexOf("/")!==0&&(e="/"+e),e},te=function(e){if(!e)return"";var n="?";return new f(e)._each(function(t,r){(d(r)||s(r)||b(r))&&(n=n+encodeURIComponent(t)+"="+encodeURIComponent(r)+"&")}),n==="?"&&(n=""),n.replace(/&$/,"")},i=function(e,n,t,r){n=D(n);var o=ee(t)+te(r);return n&&(o=e+n+o),o},c=function(e,n,t,r,o,u,_){var I=function(S){if(_){var k="geetest_"+F();l[k]=q(_,null,k),o.callback=k}var P=i(n,t[S],r,o);Y(P,function(oe){if(oe){if(k)try{l[k]=function(){l[k]=null}}catch{}S>=t.length-1?u(!0):I(S+1)}else u(!1)},e.timeout)};I(0)},w=function(e,n,t,r){var o=function(u,_){_.status=="success"?r(_.data):(_.status,r(_)),l[u]=void 0;try{delete l[u]}catch{}};c(t,t.protocol,e,n,{callback:"",captcha_id:t.captchaId,challenge:t.challenge||m(),client_type:T?"h5":"web",risk_type:t.riskType,user_info:t.userInfo,call_type:t.callType,lang:t.language?t.language:navigator.appName==="Netscape"?navigator.language.toLowerCase():navigator.userLanguage.toLowerCase()},function(u){if(u&&typeof t.offlineCb=="function"){t.offlineCb();return}u&&r(t._get_fallback_config())},o)},E=function(e,n,t){var r={networkError:"\u7F51\u7EDC\u9519\u8BEF",gtTypeError:"gt\u5B57\u6BB5\u4E0D\u662F\u5B57\u7B26\u4E32\u7C7B\u578B"};if(typeof n.onError=="function")n.onError({desc:t.desc,msg:t.msg,code:t.code});else throw new Error(r[e])},re=function(){return l.Geetest||h.getElementById("gt_lib")};re()&&(x.slide="loaded");var ne=function(e){var n=!1,t={js:"script",css:"link"},r=e&&t[e.split(".").pop()];if(r!==void 0){var o=h.getElementsByTagName(r);for(var u in o)(o[u].href&&o[u].href.toString().indexOf(e)>0||o[u].src&&o[u].src.toString().indexOf(e)>0)&&(n=!0)}return n};l.initGeetest4=function(e,n){var t=new p(e);e.https?t.protocol="https://":e.protocol||(t.protocol=l.location.protocol+"//"),O(e.getType)&&t._extend(e.getType),w(t.apiServers,t.typePath,t,function(o){var o=$(o);if(o.status==="error")return E("networkError",t,o);var u=o.type;t.debug&&new f(o)._extend(t.debug);var _=function(){t._extend(o),n(new l.Geetest4(t))};C[u]=C[u]||[];var I=x[u]||"init";if(I==="init")x[u]="loading",C[u].push(_),o.gctPath&&c(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:o.staticServers||t.staticServers,o.gctPath,null,function(S){S&&E("networkError",t,{code:"60205",msg:"Network failure",desc:{detail:"gct resource load timeout"}})}),c(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:o.staticServers||t.staticServers,o.bypass||o.staticPath+o.js,null,function(S){if(S)x[u]="fail",E("networkError",t,{code:"60204",msg:"Network failure",desc:{detail:"js resource load timeout"}});else{x[u]="loaded";for(var k=C[u],P=0,oe=k.length;P<oe;P=P+1){var ae=k[P];V(ae)&&ae()}C[u]=[],x[u]="init"}});else{if(I==="loaded")return o.gctPath&&!ne(o.gctPath)&&c(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:o.staticServers||t.staticServers,o.gctPath,null,function(S){S&&E("networkError",t,{code:"60205",msg:"Network failure",desc:{detail:"gct resource load timeout"}})}),_();I==="fail"?E("networkError",t,{code:"60204",msg:"Network failure",desc:{detail:"js resource load timeout"}}):I==="loading"&&C[u].push(_)}})}})(window);const Xe=fe('<div id="captcha"></div>'),rt=()=>{const l=H("logo").split(`
`),h=ge(l[0],l.pop()),g=$e(),v=Ie(()=>`${H("site_title")}`);Ne(v);const y=ge("white","$neutral1"),[f,m]=G(localStorage.getItem("username")||""),[p,s]=G(localStorage.getItem("password")||""),[d,b]=G(""),[O,V]=G(!1),[T,C]=Ee("remember-pwd","false"),[x,F]=G(!1),[q,j]=ie(async()=>{const i=localStorage.getItem("captcha"),c=i?JSON.parse(i):null;return x()?N.post("/auth/login/ldap",{username:f(),password:p(),otp_code:d(),captcha_output:c.captcha_output,pass_token:c.pass_token,gen_time:c.gen_time,sign_token:c.sign_token}):N.post("/auth/login/hash",{username:f(),password:Je(p()),otp_code:d(),lot_number:c.lot_number,captcha_output:c.captcha_output,pass_token:c.pass_token,gen_time:c.gen_time,sign_token:c.sign_token})}),[,Z]=ie((i,c,w)=>N.post("/authn/webauthn_finish_login?username="+w,JSON.stringify(c),{headers:{session:i}})),[,W]=ie(i=>N.get("/authn/webauthn_begin_login?username="+i)),{searchParams:U,to:B}=ve(),Q=K("webauthn_login_enabled"),X=async()=>{V(!O())},A=async()=>{if(O()){if(!ze()){L.error(g("users.webauthn_not_supported"));return}R(),T()==="true"?localStorage.setItem("username",f()):localStorage.removeItem("username");const i=await W(f());Me(i,async c=>{try{const w=Fe(c.options),E=await De(w),re=await Z(c.session,E,f());de(re,ne=>{L.success(g("login.success")),R(ne.token),B(decodeURIComponent(U.redirect||z||"/"),!0)})}catch(w){w instanceof Error&&L.error(w.message)}})}else{T()==="true"?(localStorage.setItem("username",f()),localStorage.setItem("password",p())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const i=await j();de(i,c=>{L.success(g("login.success")),R(c.token),B(decodeURIComponent(U.redirect||z||"/"),!0)},(c,w)=>{!$()&&w===402?Y(!0):L.error(c)})}},[$,Y]=G(!1),D=K("ldap_login_enabled"),ee=H("ldap_login_tips");D&&F(!0);const te=()=>{initGeetest4({captchaId:"ddd701191607e83c9d8d87020099d5aa",product:"popup"},function(i){i.appendTo("#captcha"),i.onReady(function(){}).onSuccess(function(){let c=i.getValidate();console.log(c),localStorage.setItem("captcha",JSON.stringify(c)),A()}).onError(function(){L.error("\u80A5\u9E21\u9A8C\u8BC1\u5931\u8D25")})})};return a(Ae,{zIndex:"1",w:"$full",h:"100vh",get children(){return[a(Oe,{get bgColor(){return y()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[a(ce,{alignItems:"center",justifyContent:"space-around",get children(){return[a(Te,{mr:"$2",boxSize:"$12",get src(){return h()}}),a(je,{color:"$info9",fontSize:"$2xl",get children(){return v()}})]}}),a(M,{get when(){return!$()},get fallback(){return a(le,{id:"totp",name:"otp",get placeholder(){return g("login.otp-tips")},get value(){return d()},onInput:i=>b(i.currentTarget.value),onKeyDown:i=>{i.key==="Enter"&&A()}})},get children(){return[a(le,{name:"username",get placeholder(){return g("login.username-tips")},get value(){return f()},onInput:i=>m(i.currentTarget.value)}),a(M,{get when(){return!O()},get children(){return a(le,{name:"password",get placeholder(){return g("login.password-tips")},type:"password",get value(){return p()},onInput:i=>s(i.currentTarget.value),onKeyDown:i=>{i.key==="Enter"&&A()}})}}),a(ce,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[a(pe,{get checked(){return T()==="true"},onChange:()=>C(T()==="true"?"false":"true"),get children(){return g("login.remember")}}),a(Pe,{as:"a",target:"_blank",get href(){return g("login.forget_url")},get children(){return g("login.forget")}})]}})]}}),a(Ge,{w:"$full",spacing:"$2",get children(){return[a(M,{get when(){return!O()},get children(){return a(ue,{colorScheme:"primary",w:"$full",onClick:()=>{$()?b(""):(m(""),s(""))},get children(){return g("login.clear")}})}}),a(ue,{w:"$full",get loading(){return q()},class:"g-recaptcha","data-sitekey":"reCAPTCHA_site_key","data-callback":"onSubmit","data-action":"submit",onclick:te,get children(){return g("login.login")}})]}}),a(M,{when:D,get children(){return a(pe,{w:"$full",get checked(){return x()===!0},onChange:()=>F(!x()),children:ee})}}),a(ue,{w:"$full",colorScheme:"accent",onClick:()=>{R(),B(decodeURIComponent(U.redirect||z||"/"),!0)},get children(){return g("login.use_guest")}}),Xe.cloneNode(!0),a(ce,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[a(Le,{}),a(Re,{}),a(Qe,{}),a(M,{when:Q,get children(){return a(_e,{cursor:"pointer",boxSize:"$8",get color(){return Ue()},as:Be,p:"$0_5",onclick:X})}})]}})]}}),a(We,{})]}})};export{rt as default};
