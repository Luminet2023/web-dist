import{c8 as ye,E as he,c9 as me,ca as K,aH as pe,X as ge,h as s,a7 as se,aE as V,U as H,b as ve,c4 as R,cb as D,e as be,aB as _e,b6 as F,bV as xe,cc as we,cd as Se,ce as ke,cf as Ce,a as $e,k as Ie,m as b,cg as Ee,aT as ie,a4 as Oe,bO as ce,ar as je,bN as Te,S as z,I as le,ch as fe,b2 as Pe,aq as Ge,C as ue,bh as Le,bi as Re,ag as Ue,ci as Be,av as Ae,bE as de,n as I,b7 as Me,c as ze,cj as Fe}from"./index.5c604dd9.js";import{a as De}from"./useTitle.4057136b.js";import{s as Ne,g as He,a as Ke}from"./webauthn-json.browser-ponyfill.1c672167.js";const Ve="https://github.com/alist-org/alist";function qe(c){return ye(`${c}-${Ve}`)}var Je=pe('<svg version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink height=896 width=967.8852157128662><defs><path id=path-2 opacity=1 fill-rule=evenodd d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id=linearGradient-3 x1=0.5 y1=0 x2=0.5 y2=1><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use xlink:href=#path-2 fill=url(#linearGradient-3) fill-opacity=1>');const Ze=c=>{const d=he({startColor:"#28aff0",endColor:"#120fc4"},c);return(()=>{var u=Je(),v=u.firstChild,x=v.firstChild,g=x.nextSibling,h=g.firstChild,_=h.nextSibling;return me(l=>{var m=d.startColor,w=d.endColor;return m!==l.e&&K(h,"stop-color",l.e=m),w!==l.t&&K(_,"stop-color",l.t=w),l},{e:void 0,t:void 0}),u})()};var We=pe('<svg height=1337 width=1337><defs><path id=path-1 opacity=1 fill-rule=evenodd d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id=linearGradient-2 x1=0.79 y1=0.62 x2=0.21 y2=0.86><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use xlink:href=#path-1 fill=url(#linearGradient-2) fill-opacity=1>');const Qe=c=>{const d=he({startColor:"#28aff0",endColor:"#120fc4"},c);return(()=>{var u=We(),v=u.firstChild,x=v.firstChild,g=x.nextSibling,h=g.firstChild,_=h.nextSibling;return me(l=>{var m=d.startColor,w=d.endColor;return m!==l.e&&K(h,"stop-color",l.e=m),w!==l.t&&K(_,"stop-color",l.t=w),l},{e:void 0,t:void 0}),u})()},Xe=()=>{const c=ge("#a9c6ff","#062b74");return s(se,{get bgColor(){return c()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[s(se,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return s(Qe,{})}}),s(se,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return s(Ze,{})}})]}})},Ye=()=>{const c=V("sso_login_enabled"),d=H("sso_login_platform"),u=V("sso_compatibility_mode"),{searchParams:v,to:x}=ve(),g=v.token;g!=null&&g!=""&&(R(g),x(decodeURIComponent(v.redirect||D||"/"),!0));function h(_){const l=_.data;l.token&&(R(l.token),x(decodeURIComponent(v.redirect||D||"/"),!0))}if(window.addEventListener("message",h),be(()=>{window.removeEventListener("message",h)}),c){const _=()=>{const m=F.getUri()+"/auth/sso?method=sso_get_token";if(u){window.location.href=m;return}window.open(m,"authPopup","width=500,height=600")};let l;switch(d){case"Github":l=Ce;break;case"Microsoft":l=ke;break;case"Google":l=Se;break;case"Dingtalk":l=we;break;default:l=xe}return s(_e,{cursor:"pointer",boxSize:"$8",as:l,p:"$0_5",onclick:_})}};(function(c){if(typeof c>"u")throw new Error("Geetest requires browser environment");var d=c.document,u=c.Math,v=d.getElementsByTagName("head")[0],x=1e4;function g(e){this._obj=e}g.prototype={_each:function(e){var o=this._obj;for(var t in o)o.hasOwnProperty(t)&&e(t,o[t]);return this},_extend:function(e){var o=this;new g(e)._each(function(t,n){o._obj[t]=n})}};var h=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var o=u.random()*16|0,t=e==="x"?o:o&3|8;return t.toString(16)})};function _(e){var o=this;new g(e)._each(function(t,n){o[t]=n})}_.prototype={apiServers:["gcaptcha4.geetest.com","gcaptcha4.geevisit.com","gcaptcha4.gsensebot.com"],staticServers:["static.geetest.com","static.geevisit.com"],protocol:"http://",typePath:"/load",fallback_config:{bypass:{staticServers:["static.geetest.com","static.geevisit.com"],type:"bypass",bypass:"/v4/bypass.js"}},_get_fallback_config:function(){var e=this;return m(e.type)?e.fallback_config[e.type]:e.fallback_config.bypass},_extend:function(e){var o=this;new g(e)._each(function(t,n){o[t]=n})}};var l=function(e){return typeof e=="number"},m=function(e){return typeof e=="string"},w=function(e){return typeof e=="boolean"},q=function(e){return typeof e=="object"&&e!==null},J=function(e){return typeof e=="function"},Z=/Mobi/i.test(navigator.userAgent),S={},k={},W=function(){return parseInt(u.random()*1e4)+new Date().valueOf()},T=function(e,o){if(typeof e=="function"){var t=Array.prototype.slice.call(arguments,2);return Function.prototype.bind?e.bind(o,t):function(){var n=Array.prototype.slice.call(arguments);return e.apply(o,t.concat(n))}}},E=Object.prototype.toString,U=function(e){return typeof e=="function"},N=function(e){return e===Object(e)},P=function(e){return E.call(e)=="[object Array]"},Q=function(e){return E.call(e)=="[object Date]"},G=function(e){return E.call(e)=="[object RegExp]"},X=function(e){return E.call(e)=="[object Boolean]"};function B(e){return e.replace(/(\S)(_([a-zA-Z]))/g,function(o,t,n,a){return t+a.toUpperCase()||""})}function O(e,o){if(!N(e)||Q(e)||G(e)||X(e)||U(e))return o?B(e):e;if(P(e))for(var t=[],n=0;n<e.length;n++)t.push(O(e[n]));else{var t={};for(var a in e)e.hasOwnProperty(a)&&(t[O(a,!0)]=O(e[a]))}return t}var Y=function(e,o,t){var n=d.createElement("script");n.charset="UTF-8",n.async=!0,/static\.geetest\.com/g.test(e)&&(n.crossOrigin="anonymous"),n.onerror=function(){o(!0),a=!0};var a=!1;n.onload=n.onreadystatechange=function(){!a&&(!n.readyState||n.readyState==="loaded"||n.readyState==="complete")&&(a=!0,setTimeout(function(){o(!1)},0))},n.src=e,v.appendChild(n),setTimeout(function(){a||(n.onerror=n.onload=null,n.remove&&n.remove(),o(!0))},t||x)},ee=function(e){return e.replace(/^https?:\/\/|\/$/g,"")},te=function(e){return e=e&&e.replace(/\/+/g,"/"),e.indexOf("/")!==0&&(e="/"+e),e},re=function(e){if(!e)return"";var o="?";return new g(e)._each(function(t,n){(m(n)||l(n)||w(n))&&(o=o+encodeURIComponent(t)+"="+encodeURIComponent(n)+"&")}),o==="?"&&(o=""),o.replace(/&$/,"")},A=function(e,o,t,n){o=ee(o);var a=te(t)+re(n);return o&&(a=e+o+a),a},C=function(e,o,t,n,a,r,i){var p=function(f){if(i){var y="geetest_"+W();c[y]=T(i,null,y),a.callback=y}var $=A(o,t[f],n,a);Y($,function(oe){if(oe){if(y)try{c[y]=function(){c[y]=null}}catch{}f>=t.length-1?r(!0):p(f+1)}else r(!1)},e.timeout)};p(0)},ne=function(e,o,t,n){var a=function(r,i){i.status=="success"?n(i.data):(i.status,n(i)),c[r]=void 0;try{delete c[r]}catch{}};C(t,t.protocol,e,o,{callback:"",captcha_id:t.captchaId,challenge:t.challenge||h(),client_type:Z?"h5":"web",risk_type:t.riskType,user_info:t.userInfo,call_type:t.callType,lang:t.language?t.language:navigator.appName==="Netscape"?navigator.language.toLowerCase():navigator.userLanguage.toLowerCase()},function(r){if(r&&typeof t.offlineCb=="function"){t.offlineCb();return}r&&n(t._get_fallback_config())},a)},j=function(e,o,t){var n={networkError:"\u7F51\u7EDC\u9519\u8BEF",gtTypeError:"gt\u5B57\u6BB5\u4E0D\u662F\u5B57\u7B26\u4E32\u7C7B\u578B"};if(typeof o.onError=="function")o.onError({desc:t.desc,msg:t.msg,code:t.code});else throw new Error(n[e])},L=function(){return c.Geetest||d.getElementById("gt_lib")};L()&&(k.slide="loaded");var M=function(e){var o=!1,t={js:"script",css:"link"},n=e&&t[e.split(".").pop()];if(n!==void 0){var a=d.getElementsByTagName(n);for(var r in a)(a[r].href&&a[r].href.toString().indexOf(e)>0||a[r].src&&a[r].src.toString().indexOf(e)>0)&&(o=!0)}return o};c.initGeetest4=function(e,o){var t=new _(e);e.https?t.protocol="https://":e.protocol||(t.protocol=c.location.protocol+"//"),q(e.getType)&&t._extend(e.getType),ne(t.apiServers,t.typePath,t,function(a){var a=O(a);if(a.status==="error")return j("networkError",t,a);var r=a.type;t.debug&&new g(a)._extend(t.debug);var i=function(){t._extend(a),o(new c.Geetest4(t))};S[r]=S[r]||[];var p=k[r]||"init";if(p==="init")k[r]="loading",S[r].push(i),a.gctPath&&C(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:a.staticServers||t.staticServers,a.gctPath,null,function(f){f&&j("networkError",t,{code:"60205",msg:"Network failure",desc:{detail:"gct resource load timeout"}})}),C(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:a.staticServers||t.staticServers,a.bypass||a.staticPath+a.js,null,function(f){if(f)k[r]="fail",j("networkError",t,{code:"60204",msg:"Network failure",desc:{detail:"js resource load timeout"}});else{k[r]="loaded";for(var y=S[r],$=0,oe=y.length;$<oe;$=$+1){var ae=y[$];J(ae)&&ae()}S[r]=[],k[r]="init"}});else{if(p==="loaded")return a.gctPath&&!M(a.gctPath)&&C(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:a.staticServers||t.staticServers,a.gctPath,null,function(f){f&&j("networkError",t,{code:"60205",msg:"Network failure",desc:{detail:"gct resource load timeout"}})}),i();p==="fail"?j("networkError",t,{code:"60204",msg:"Network failure",desc:{detail:"js resource load timeout"}}):p==="loading"&&S[r].push(i)}})}})(window);var et=pe("<div id=captcha>");const ot=()=>{const c=H("logo").split(`
`),d=ge(c[0],c.pop()),u=$e(),v=Ie(()=>`${H("site_title")}`);De(v);const x=ge("white","$neutral1"),[g,h]=b(localStorage.getItem("username")||""),[_,l]=b(localStorage.getItem("lot_number")||""),[m,w]=b(localStorage.getItem("captcha_output")||""),[q,J]=b(localStorage.getItem("pass_token")||""),[Z,S]=b(localStorage.getItem("gen_time")||""),[k,W]=b(localStorage.getItem("sign_token")||""),[T,E]=b(localStorage.getItem("password")||""),[U,N]=b(""),[P,Q]=b(!1),[G,X]=Ee("remember-pwd","false"),[B,O]=b(!1),[Y,ee]=ie(async()=>{const r=localStorage.getItem("captcha");return r&&JSON.parse(r),B()?F.post("/auth/login/ldap",{username:g(),password:T(),otp_code:U()}):F.post("/auth/login/hash",{username:g(),password:qe(T()),otp_code:U(),lot_number:_(),captcha_output:m(),pass_token:q(),gen_time:Z(),sign_token:k()})}),[,te]=ie((r,i,p)=>F.post("/authn/webauthn_finish_login?username="+p,JSON.stringify(i),{headers:{session:r}})),[,re]=ie(r=>F.get("/authn/webauthn_begin_login?username="+r)),{searchParams:A,to:C}=ve(),ne=V("webauthn_login_enabled"),j=async()=>{Q(!P())},L=async()=>{if(P()){if(!Ne()){I.error(u("users.webauthn_not_supported"));return}R(),G()==="true"?localStorage.setItem("username",g()):localStorage.removeItem("username");const r=await re(g());Me(r,async i=>{try{const p=He(i.options),f=await Ke(p),y=await te(i.session,f,g());de(y,$=>{I.success(u("login.success")),R($.token),C(decodeURIComponent(A.redirect||D||"/"),!0)})}catch(p){p instanceof Error&&I.error(p.message)}})}else{G()==="true"?(localStorage.setItem("username",g()),localStorage.setItem("password",T())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const r=await ee();de(r,i=>{I.success(u("login.success")),R(i.token),C(decodeURIComponent(A.redirect||D||"/"),!0)},(i,p)=>{!M()&&p===402?e(!0):I.error(i)})}},[M,e]=b(!1),o=V("ldap_login_enabled"),t=H("ldap_login_tips");o&&O(!0);async function n(r){try{return(await ze.get(r)).data}catch(i){throw I.error(i),i}}const a=()=>{const r=Fe+"/api/auth/need_captcha";n(r).then(i=>{i.need_captcha,i.need_captcha===!0?initGeetest4({captchaId:"ddd701191607e83c9d8d87020099d5aa",product:"popup"},function(p){p.appendTo("#captcha"),p.onReady(function(){}).onSuccess(function(){let f=p.getValidate();l(f.lot_number),w(f.captcha_output),J(f.pass_token),S(f.gen_time),W(f.sign_token),L()}).onError(function(){I.error("\u80A5\u9E21\u9A8C\u8BC1\u5931\u8D25")})}):L()}).catch(i=>{I.error("\u80A5\u9E21\u9A8C\u8BC1\u5931\u8D25")})};return s(Ae,{zIndex:"1",w:"$full",h:"100vh",get children(){return[s(Oe,{get bgColor(){return x()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[s(ce,{alignItems:"center",justifyContent:"space-around",get children(){return[s(je,{mr:"$2",boxSize:"$12",get src(){return d()}}),s(Te,{color:"$info9",fontSize:"$2xl",get children(){return v()}})]}}),s(z,{get when(){return!M()},get fallback(){return s(le,{id:"totp",name:"otp",get placeholder(){return u("login.otp-tips")},get value(){return U()},onInput:r=>N(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&L()}})},get children(){return[s(le,{name:"username",get placeholder(){return u("login.username-tips")},get value(){return g()},onInput:r=>h(r.currentTarget.value)}),s(z,{get when(){return!P()},get children(){return s(le,{name:"password",get placeholder(){return u("login.password-tips")},type:"password",get value(){return T()},onInput:r=>E(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&L()}})}}),s(ce,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[s(fe,{get checked(){return G()==="true"},onChange:()=>X(G()==="true"?"false":"true"),get children(){return u("login.remember")}}),s(Pe,{as:"a",target:"_blank",get href(){return u("login.forget_url")},get children(){return u("login.forget")}})]}})]}}),s(Ge,{w:"$full",spacing:"$2",get children(){return[s(z,{get when(){return!P()},get children(){return s(ue,{colorScheme:"primary",w:"$full",onClick:()=>{M()?N(""):(h(""),E(""))},get children(){return u("login.clear")}})}}),s(ue,{w:"$full",get loading(){return Y()},class:"g-recaptcha","data-sitekey":"reCAPTCHA_site_key","data-callback":"onSubmit","data-action":"submit",onclick:a,get children(){return u("login.login")}})]}}),s(z,{when:o,get children(){return s(fe,{w:"$full",get checked(){return B()===!0},onChange:()=>O(!B()),children:t})}}),s(ue,{w:"$full",colorScheme:"accent",onClick:()=>{R(),C(decodeURIComponent(A.redirect||D||"/"),!0)},get children(){return u("login.use_guest")}}),et(),s(ce,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[s(Le,{}),s(Re,{}),s(Ye,{}),s(z,{when:ne,get children(){return s(_e,{cursor:"pointer",boxSize:"$8",get color(){return Ue()},as:Be,p:"$0_5",onclick:j})}})]}})]}}),s(Xe,{})]}})};export{ot as default};
