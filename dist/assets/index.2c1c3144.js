import{c7 as ye,E as he,c8 as me,c9 as J,aH as ge,X as fe,h as a,a7 as se,aE as K,U as H,b as ve,c3 as U,ca as z,e as be,aB as _e,b6 as N,bV as xe,cb as we,cc as Se,cd as ke,ce as Ce,a as $e,k as Ie,m as R,cf as Ee,aT as ie,a4 as Oe,bO as ce,ar as Te,bN as je,S as M,I as le,cg as pe,b2 as Pe,aq as Ge,C as ue,bh as Le,bi as Re,ag as Ue,ch as Be,av as Ae,bE as de,n as E,b7 as Me,c as Ne,ci as ze}from"./index.9cb0a02c.js";import{a as Fe}from"./useTitle.fd78b631.js";import{s as De,g as He,a as Je}from"./webauthn-json.browser-ponyfill.1c672167.js";const Ke="https://github.com/alist-org/alist";function Ve(l){return ye(`${l}-${Ke}`)}const qe=ge('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="896" width="967.8852157128662"><defs><path id="path-2" opacity="1" fill-rule="evenodd" d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id="linearGradient-3" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-2" fill="url(#linearGradient-3)" fill-opacity="1"></use></g></svg>'),Ze=l=>{const m=he({startColor:"#28aff0",endColor:"#120fc4"},l);return(()=>{const f=qe.cloneNode(!0),_=f.firstChild,b=_.firstChild,g=b.nextSibling,v=g.firstChild,d=v.nextSibling;return me(c=>{const h=m.startColor,x=m.endColor;return h!==c._v$&&J(v,"stop-color",c._v$=h),x!==c._v$2&&J(d,"stop-color",c._v$2=x),c},{_v$:void 0,_v$2:void 0}),f})()},We=ge('<svg height="1337" width="1337"><defs><path id="path-1" opacity="1" fill-rule="evenodd" d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id="linearGradient-2" x1="0.79" y1="0.62" x2="0.21" y2="0.86"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-1" fill="url(#linearGradient-2)" fill-opacity="1"></use></g></svg>'),Qe=l=>{const m=he({startColor:"#28aff0",endColor:"#120fc4"},l);return(()=>{const f=We.cloneNode(!0),_=f.firstChild,b=_.firstChild,g=b.nextSibling,v=g.firstChild,d=v.nextSibling;return me(c=>{const h=m.startColor,x=m.endColor;return h!==c._v$&&J(v,"stop-color",c._v$=h),x!==c._v$2&&J(d,"stop-color",c._v$2=x),c},{_v$:void 0,_v$2:void 0}),f})()},Xe=()=>{const l=fe("#a9c6ff","#062b74");return a(se,{get bgColor(){return l()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[a(se,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return a(Qe,{})}}),a(se,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return a(Ze,{})}})]}})},Ye=()=>{const l=K("sso_login_enabled"),m=H("sso_login_platform"),f=K("sso_compatibility_mode"),{searchParams:_,to:b}=ve(),g=_.token;g!=null&&g!=""&&(U(g),b(decodeURIComponent(_.redirect||z||"/"),!0));function v(d){const c=d.data;c.token&&(U(c.token),b(decodeURIComponent(_.redirect||z||"/"),!0))}if(window.addEventListener("message",v),be(()=>{window.removeEventListener("message",v)}),l){const d=()=>{const h=N.getUri()+"/auth/sso?method=sso_get_token";if(f){window.location.href=h;return}window.open(h,"authPopup","width=500,height=600")};let c;switch(m){case"Github":c=Ce;break;case"Microsoft":c=ke;break;case"Google":c=Se;break;case"Dingtalk":c=we;break;default:c=xe}return a(_e,{cursor:"pointer",boxSize:"$8",as:c,p:"$0_5",onclick:d})}};(function(l){if(typeof l>"u")throw new Error("Geetest requires browser environment");var m=l.document,f=l.Math,_=m.getElementsByTagName("head")[0],b=1e4;function g(e){this._obj=e}g.prototype={_each:function(e){var n=this._obj;for(var t in n)n.hasOwnProperty(t)&&e(t,n[t]);return this},_extend:function(e){var n=this;new g(e)._each(function(t,r){n._obj[t]=r})}};var v=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=f.random()*16|0,t=e==="x"?n:n&3|8;return t.toString(16)})};function d(e){var n=this;new g(e)._each(function(t,r){n[t]=r})}d.prototype={apiServers:["gcaptcha4.geetest.com","gcaptcha4.geevisit.com","gcaptcha4.gsensebot.com"],staticServers:["static.geetest.com","static.geevisit.com"],protocol:"http://",typePath:"/load",fallback_config:{bypass:{staticServers:["static.geetest.com","static.geevisit.com"],type:"bypass",bypass:"/v4/bypass.js"}},_get_fallback_config:function(){var e=this;return h(e.type)?e.fallback_config[e.type]:e.fallback_config.bypass},_extend:function(e){var n=this;new g(e)._each(function(t,r){n[t]=r})}};var c=function(e){return typeof e=="number"},h=function(e){return typeof e=="string"},x=function(e){return typeof e=="boolean"},O=function(e){return typeof e=="object"&&e!==null},V=function(e){return typeof e=="function"},T=/Mobi/i.test(navigator.userAgent),C={},w={},F=function(){return parseInt(f.random()*1e4)+new Date().valueOf()},q=function(e,n){if(typeof e=="function"){var t=Array.prototype.slice.call(arguments,2);return Function.prototype.bind?e.bind(n,t):function(){var r=Array.prototype.slice.call(arguments);return e.apply(n,t.concat(r))}}},j=Object.prototype.toString,Z=function(e){return typeof e=="function"},W=function(e){return e===Object(e)},B=function(e){return j.call(e)=="[object Array]"},A=function(e){return j.call(e)=="[object Date]"},Q=function(e){return j.call(e)=="[object RegExp]"},X=function(e){return j.call(e)=="[object Boolean]"};function P(e){return e.replace(/(\S)(_([a-zA-Z]))/g,function(n,t,r,o){return t+o.toUpperCase()||""})}function $(e,n){if(!W(e)||A(e)||Q(e)||X(e)||Z(e))return n?P(e):e;if(B(e))for(var t=[],r=0;r<e.length;r++)t.push($(e[r]));else{var t={};for(var o in e)e.hasOwnProperty(o)&&(t[$(o,!0)]=$(e[o]))}return t}var Y=function(e,n,t){var r=m.createElement("script");r.charset="UTF-8",r.async=!0,/static\.geetest\.com/g.test(e)&&(r.crossOrigin="anonymous"),r.onerror=function(){n(!0),o=!0};var o=!1;r.onload=r.onreadystatechange=function(){!o&&(!r.readyState||r.readyState==="loaded"||r.readyState==="complete")&&(o=!0,setTimeout(function(){n(!1)},0))},r.src=e,_.appendChild(r),setTimeout(function(){o||(r.onerror=r.onload=null,r.remove&&r.remove(),n(!0))},t||b)},D=function(e){return e.replace(/^https?:\/\/|\/$/g,"")},ee=function(e){return e=e&&e.replace(/\/+/g,"/"),e.indexOf("/")!==0&&(e="/"+e),e},te=function(e){if(!e)return"";var n="?";return new g(e)._each(function(t,r){(h(r)||c(r)||x(r))&&(n=n+encodeURIComponent(t)+"="+encodeURIComponent(r)+"&")}),n==="?"&&(n=""),n.replace(/&$/,"")},re=function(e,n,t,r){n=D(n);var o=ee(t)+te(r);return n&&(o=e+n+o),o},s=function(e,n,t,r,o,u,y){var I=function(S){if(y){var k="geetest_"+F();l[k]=q(y,null,k),o.callback=k}var L=re(n,t[S],r,o);Y(L,function(oe){if(oe){if(k)try{l[k]=function(){l[k]=null}}catch{}S>=t.length-1?u(!0):I(S+1)}else u(!1)},e.timeout)};I(0)},i=function(e,n,t,r){var o=function(u,y){y.status=="success"?r(y.data):(y.status,r(y)),l[u]=void 0;try{delete l[u]}catch{}};s(t,t.protocol,e,n,{callback:"",captcha_id:t.captchaId,challenge:t.challenge||v(),client_type:T?"h5":"web",risk_type:t.riskType,user_info:t.userInfo,call_type:t.callType,lang:t.language?t.language:navigator.appName==="Netscape"?navigator.language.toLowerCase():navigator.userLanguage.toLowerCase()},function(u){if(u&&typeof t.offlineCb=="function"){t.offlineCb();return}u&&r(t._get_fallback_config())},o)},p=function(e,n,t){var r={networkError:"\u7F51\u7EDC\u9519\u8BEF",gtTypeError:"gt\u5B57\u6BB5\u4E0D\u662F\u5B57\u7B26\u4E32\u7C7B\u578B"};if(typeof n.onError=="function")n.onError({desc:t.desc,msg:t.msg,code:t.code});else throw new Error(r[e])},G=function(){return l.Geetest||m.getElementById("gt_lib")};G()&&(w.slide="loaded");var ne=function(e){var n=!1,t={js:"script",css:"link"},r=e&&t[e.split(".").pop()];if(r!==void 0){var o=m.getElementsByTagName(r);for(var u in o)(o[u].href&&o[u].href.toString().indexOf(e)>0||o[u].src&&o[u].src.toString().indexOf(e)>0)&&(n=!0)}return n};l.initGeetest4=function(e,n){var t=new d(e);e.https?t.protocol="https://":e.protocol||(t.protocol=l.location.protocol+"//"),O(e.getType)&&t._extend(e.getType),i(t.apiServers,t.typePath,t,function(o){var o=$(o);if(o.status==="error")return p("networkError",t,o);var u=o.type;t.debug&&new g(o)._extend(t.debug);var y=function(){t._extend(o),n(new l.Geetest4(t))};C[u]=C[u]||[];var I=w[u]||"init";if(I==="init")w[u]="loading",C[u].push(y),o.gctPath&&s(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:o.staticServers||t.staticServers,o.gctPath,null,function(S){S&&p("networkError",t,{code:"60205",msg:"Network failure",desc:{detail:"gct resource load timeout"}})}),s(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:o.staticServers||t.staticServers,o.bypass||o.staticPath+o.js,null,function(S){if(S)w[u]="fail",p("networkError",t,{code:"60204",msg:"Network failure",desc:{detail:"js resource load timeout"}});else{w[u]="loaded";for(var k=C[u],L=0,oe=k.length;L<oe;L=L+1){var ae=k[L];V(ae)&&ae()}C[u]=[],w[u]="init"}});else{if(I==="loaded")return o.gctPath&&!ne(o.gctPath)&&s(t,t.protocol,Object.hasOwnProperty.call(t,"staticServers")?t.staticServers:o.staticServers||t.staticServers,o.gctPath,null,function(S){S&&p("networkError",t,{code:"60205",msg:"Network failure",desc:{detail:"gct resource load timeout"}})}),y();I==="fail"?p("networkError",t,{code:"60204",msg:"Network failure",desc:{detail:"js resource load timeout"}}):I==="loading"&&C[u].push(y)}})}})(window);const et=ge('<div id="captcha"></div>'),ot=()=>{const l=H("logo").split(`
`),m=fe(l[0],l.pop()),f=$e(),_=Ie(()=>`${H("site_title")}`);Fe(_);const b=fe("white","$neutral1"),[g,v]=R(localStorage.getItem("username")||""),[d,c]=R(localStorage.getItem("password")||""),[h,x]=R(""),[O,V]=R(!1),[T,C]=Ee("remember-pwd","false"),[w,F]=R(!1),[q,j]=ie(async()=>{const s=localStorage.getItem("captcha"),i=s?JSON.parse(s):null;return w()?N.post("/auth/login/ldap",{username:g(),password:d(),otp_code:h(),captcha_output:i.captcha_output,pass_token:i.pass_token,gen_time:i.gen_time,sign_token:i.sign_token}):N.post("/auth/login/hash",{username:g(),password:Ve(d()),otp_code:h(),lot_number:i.lot_number,captcha_output:i.captcha_output,pass_token:i.pass_token,gen_time:i.gen_time,sign_token:i.sign_token})}),[,Z]=ie((s,i,p)=>N.post("/authn/webauthn_finish_login?username="+p,JSON.stringify(i),{headers:{session:s}})),[,W]=ie(s=>N.get("/authn/webauthn_begin_login?username="+s)),{searchParams:B,to:A}=ve(),Q=K("webauthn_login_enabled"),X=async()=>{V(!O())},P=async()=>{if(O()){if(!De()){E.error(f("users.webauthn_not_supported"));return}U(),T()==="true"?localStorage.setItem("username",g()):localStorage.removeItem("username");const s=await W(g());Me(s,async i=>{try{const p=He(i.options),G=await Je(p),ne=await Z(i.session,G,g());de(ne,e=>{E.success(f("login.success")),U(e.token),A(decodeURIComponent(B.redirect||z||"/"),!0)})}catch(p){p instanceof Error&&E.error(p.message)}})}else{T()==="true"?(localStorage.setItem("username",g()),localStorage.setItem("password",d())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const s=await j();de(s,i=>{E.success(f("login.success")),U(i.token),A(decodeURIComponent(B.redirect||z||"/"),!0)},(i,p)=>{!$()&&p===402?Y(!0):E.error(i)})}},[$,Y]=R(!1),D=K("ldap_login_enabled"),ee=H("ldap_login_tips");D&&F(!0);async function te(s){try{return(await Ne.get(s)).data}catch(i){throw E.error(i),i}}const re=()=>{const s=ze+"/api/auth/need_captcha";te(s).then(i=>{i.need_captcha,i.need_captcha===!0?initGeetest4({captchaId:"ddd701191607e83c9d8d87020099d5aa",product:"popup"},function(p){p.appendTo("#captcha"),p.onReady(function(){}).onSuccess(function(){let G=p.getValidate();console.log(G),localStorage.setItem("captcha",JSON.stringify(G)),P()}).onError(function(){E.error("\u80A5\u9E21\u9A8C\u8BC1\u5931\u8D25")})}):P()}).catch(i=>{E.error("\u80A5\u9E21\u9A8C\u8BC1\u5931\u8D25")})};return a(Ae,{zIndex:"1",w:"$full",h:"100vh",get children(){return[a(Oe,{get bgColor(){return b()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[a(ce,{alignItems:"center",justifyContent:"space-around",get children(){return[a(Te,{mr:"$2",boxSize:"$12",get src(){return m()}}),a(je,{color:"$info9",fontSize:"$2xl",get children(){return _()}})]}}),a(M,{get when(){return!$()},get fallback(){return a(le,{id:"totp",name:"otp",get placeholder(){return f("login.otp-tips")},get value(){return h()},onInput:s=>x(s.currentTarget.value),onKeyDown:s=>{s.key==="Enter"&&P()}})},get children(){return[a(le,{name:"username",get placeholder(){return f("login.username-tips")},get value(){return g()},onInput:s=>v(s.currentTarget.value)}),a(M,{get when(){return!O()},get children(){return a(le,{name:"password",get placeholder(){return f("login.password-tips")},type:"password",get value(){return d()},onInput:s=>c(s.currentTarget.value),onKeyDown:s=>{s.key==="Enter"&&P()}})}}),a(ce,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[a(pe,{get checked(){return T()==="true"},onChange:()=>C(T()==="true"?"false":"true"),get children(){return f("login.remember")}}),a(Pe,{as:"a",target:"_blank",get href(){return f("login.forget_url")},get children(){return f("login.forget")}})]}})]}}),a(Ge,{w:"$full",spacing:"$2",get children(){return[a(M,{get when(){return!O()},get children(){return a(ue,{colorScheme:"primary",w:"$full",onClick:()=>{$()?x(""):(v(""),c(""))},get children(){return f("login.clear")}})}}),a(ue,{w:"$full",get loading(){return q()},class:"g-recaptcha","data-sitekey":"reCAPTCHA_site_key","data-callback":"onSubmit","data-action":"submit",onclick:re,get children(){return f("login.login")}})]}}),a(M,{when:D,get children(){return a(pe,{w:"$full",get checked(){return w()===!0},onChange:()=>F(!w()),children:ee})}}),a(ue,{w:"$full",colorScheme:"accent",onClick:()=>{U(),A(decodeURIComponent(B.redirect||z||"/"),!0)},get children(){return f("login.use_guest")}}),et.cloneNode(!0),a(ce,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[a(Le,{}),a(Re,{}),a(Ye,{}),a(M,{when:Q,get children(){return a(_e,{cursor:"pointer",boxSize:"$8",get color(){return Ue()},as:Be,p:"$0_5",onclick:X})}})]}})]}}),a(Xe,{})]}})};export{ot as default};
